<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Quiz Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        header {
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .tab-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .tab.active {
            background: rgba(255, 255, 255, 0.9);
            color: #1a2a6c;
        }

        .panel {
            display: none;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .panel.active {
            display: block;
        }

        h2 {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
        }

        input, select, textarea, button {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            border: none;
            background: rgba(255, 255, 255, 0.9);
        }

        button {
            background: #4CAF50;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
        }

        button:hover {
            background: #45a049;
        }

        button:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }

        .question-list, .team-list {
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }

        .question-item, .team-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .question-item.answered {
            opacity: 0.6;
            background: rgba(76, 175, 80, 0.2);
        }

        .delete-btn {
            background: #f44336;
            width: auto;
            padding: 5px 10px;
        }

        .delete-btn:hover {
            background: #d32f2f;
        }

        .game-controls {
            display: flex;
            gap: 10px;
        }

        .game-controls button {
            flex: 1;
        }

        #questionDisplay {
            font-size: 1.5rem;
            margin-bottom: 20px;
            text-align: center;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #pointsDisplay {
            text-align: center;
            font-size: 1.2rem;
            margin-bottom: 20px;
        }

        .answer-section {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        #answerInput {
            flex: 3;
        }

        #playerNameInput {
            display: none;
        }

        #submitAnswer {
            flex: 1;
        }

        .team-selector {
            margin-bottom: 20px;
        }

        .scoreboard {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }

        .team-score {
            text-align: center;
        }

        .team-score h3 {
            margin-bottom: 5px;
        }

        .team-score p {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .leaderboard {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }

        .leaderboard h3 {
            margin-bottom: 10px;
            text-align: center;
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .leaderboard-item:last-child {
            border-bottom: none;
        }

        /* Animation for correct answer */
        @keyframes correctAnswer {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .correct {
            animation: correctAnswer 0.5s ease-in-out;
            color: #4CAF50;
        }

        /* Animation for wrong answer */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
            20%, 40%, 60%, 80% { transform: translateX(10px); }
        }

        .shake {
            animation: shake 0.5s ease-in-out;
        }

        /* Modal for correct answer */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f);
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.3);
        }

        .modal h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
        }

        .modal p {
            font-size: 1.5rem;
            margin-bottom: 20px;
        }

        .close-modal {
            background: #4CAF50;
            width: auto;
            padding: 10px 20px;
            margin-top: 10px;
        }

        .hidden {
            display: none;
        }

        .mobile-form {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
        }

        .mobile-form h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        .mobile-question {
            font-size: 1.2rem;
            margin-bottom: 20px;
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }

        .mobile-points {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.1rem;
            color: #fdbb2d;
        }

        .mobile-response {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            font-weight: bold;
        }

        .mobile-response.correct {
            background: rgba(76, 175, 80, 0.3);
            color: #4CAF50;
        }

        .mobile-response.incorrect {
            background: rgba(244, 67, 54, 0.3);
            color: #f44336;
        }

        .instructions {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-size: 0.9rem;
        }

        .instructions h4 {
            margin-bottom: 8px;
            color: #fdbb2d;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Interactive Quiz Game</h1>
            <p>Test your knowledge and compete with teams or individually!</p>
        </header>

        <div class="tab-container">
            <div class="tab active" data-tab="player">Player Panel</div>
            <div class="tab" data-tab="admin">Admin Panel</div>
            <div class="tab" data-tab="mobile">Mobile Answer</div>
        </div>

        <!-- Player Panel -->
        <div class="panel active" id="playerPanel">
            <h2>Player Panel</h2>
            
            <div class="instructions">
                <h4>How to Play:</h4>
                <p>• Select your team and answer questions</p>
                <p>• For individual questions, enter your name</p>
                <p>• Earn points for correct answers</p>
                <p>• Compete for the highest score!</p>
            </div>
            
            <div class="team-selector">
                <label for="teamSelect">Select Your Team:</label>
                <select id="teamSelect">
                    <option value="">-- Select Team --</option>
                </select>
            </div>
            
            <div id="questionDisplay">No questions available. Please add questions in the admin panel.</div>
            
            <div id="pointsDisplay">Points: 0</div>
            
            <div class="answer-section">
                <input type="text" id="playerNameInput" placeholder="Enter your name (for individual questions)">
                <input type="text" id="answerInput" placeholder="Enter your answer">
                <button id="submitAnswer">Submit Answer</button>
            </div>
            
            <div class="game-controls">
                <button id="nextQuestion">Next Question</button>
                <button id="resetGame">Reset Game</button>
            </div>
            
            <div class="scoreboard">
                <!-- Team scores will be dynamically added here -->
            </div>
            
            <div class="leaderboard">
                <h3>Individual Leaderboard</h3>
                <div id="individualLeaderboard">
                    <!-- Individual scores will be dynamically added here -->
                </div>
            </div>
        </div>

        <!-- Admin Panel -->
        <div class="panel" id="adminPanel">
            <h2>Admin Panel</h2>
            
            <div class="instructions">
                <h4>Admin Instructions:</h4>
                <p>• Add questions with correct answers</p>
                <p>• Set points and question type (Team/Individual)</p>
                <p>• Create teams for players to join</p>
                <p>• Monitor scores and progress</p>
            </div>
            
            <div class="form-group">
                <label for="questionText">Question:</label>
                <textarea id="questionText" rows="3" placeholder="Enter your question here"></textarea>
            </div>
            
            <div class="form-group">
                <label for="correctAnswer">Correct Answer:</label>
                <input type="text" id="correctAnswer" placeholder="Enter the correct answer">
            </div>
            
            <div class="form-group">
                <label for="pointsValue">Points:</label>
                <input type="number" id="pointsValue" placeholder="Enter points" min="1" value="10">
            </div>
            
            <div class="form-group">
                <label for="questionType">Question Type:</label>
                <select id="questionType">
                    <option value="team">Team Points</option>
                    <option value="individual">Individual Points</option>
                </select>
            </div>
            
            <button id="addQuestion">Add Question</button>
            
            <div class="question-list">
                <h3>Questions <span id="questionsStatus">(0/0 answered)</span></h3>
                <div id="questionsContainer"></div>
            </div>
            
            <div class="form-group">
                <label for="teamName">Team Name:</label>
                <div class="team-controls">
                    <input type="text" id="teamName" placeholder="Enter team name">
                    <button id="addTeam">Add Team</button>
                </div>
            </div>
            
            <div class="team-list">
                <h3>Teams</h3>
                <div id="teamsContainer"></div>
            </div>
        </div>

        <!-- Mobile Answer Panel -->
        <div class="panel" id="mobilePanel">
            <div class="mobile-form">
                <h2 id="mobileQuestionTitle">Answer Question</h2>
                <div class="mobile-question" id="mobileQuestionText">No active question</div>
                <div class="mobile-points" id="mobilePointsText">Points: 0</div>
                
                <div class="instructions">
                    <h4>Mobile Instructions:</h4>
                    <p>• Select your team</p>
                    <p>• For individual questions, enter your name</p>
                    <p>• Type your answer and submit</p>
                </div>
                
                <div class="form-group">
                    <label for="mobileTeamSelect">Your Team:</label>
                    <select id="mobileTeamSelect">
                        <option value="">-- Select Team --</option>
                    </select>
                </div>
                
                <div class="form-group" id="mobilePlayerNameGroup" style="display: none;">
                    <label for="mobilePlayerName">Your Name:</label>
                    <input type="text" id="mobilePlayerName" placeholder="Enter your name">
                </div>
                
                <div class="form-group">
                    <label for="mobileAnswer">Your Answer:</label>
                    <input type="text" id="mobileAnswer" placeholder="Enter your answer">
                </div>
                
                <button id="mobileSubmit">Submit Answer</button>
                
                <div id="mobileResponse" class="mobile-response"></div>
            </div>
        </div>
    </div>

    <!-- Modal for correct answer -->
    <div class="modal" id="correctModal">
        <div class="modal-content">
            <h2>Correct!</h2>
            <p>You've earned <span id="earnedPoints">0</span> points!</p>
            <button class="close-modal">Continue</button>
        </div>
    </div>

    <!-- Modal for game completion -->
    <div class="modal" id="gameCompleteModal">
        <div class="modal-content">
            <h2>Congratulations!</h2>
            <p>You've answered all the questions correctly!</p>
            <p>The game is now complete.</p>
            <button class="close-modal" id="restartGame">Play Again</button>
        </div>
    </div>

    <script>
        // Game state
        const gameState = {
            questions: [],
            teams: [],
            currentQuestionIndex: -1,
            scores: {},
            individualScores: {},
            answeredQuestions: new Set(), // Track which questions have been answered
            currentQuestionId: null
        };

        // DOM elements
        const playerElements = {
            panel: document.getElementById('playerPanel'),
            teamSelect: document.getElementById('teamSelect'),
            questionDisplay: document.getElementById('questionDisplay'),
            pointsDisplay: document.getElementById('pointsDisplay'),
            answerInput: document.getElementById('answerInput'),
            playerNameInput: document.getElementById('playerNameInput'),
            submitAnswer: document.getElementById('submitAnswer'),
            nextQuestion: document.getElementById('nextQuestion'),
            resetGame: document.getElementById('resetGame'),
            scoreboard: document.querySelector('.scoreboard'),
            individualLeaderboard: document.getElementById('individualLeaderboard')
        };

        const adminElements = {
            panel: document.getElementById('adminPanel'),
            questionText: document.getElementById('questionText'),
            correctAnswer: document.getElementById('correctAnswer'),
            pointsValue: document.getElementById('pointsValue'),
            questionType: document.getElementById('questionType'),
            addQuestion: document.getElementById('addQuestion'),
            questionsContainer: document.getElementById('questionsContainer'),
            questionsStatus: document.getElementById('questionsStatus'),
            teamName: document.getElementById('teamName'),
            addTeam: document.getElementById('addTeam'),
            teamsContainer: document.getElementById('teamsContainer')
        };

        const mobileElements = {
            panel: document.getElementById('mobilePanel'),
            questionTitle: document.getElementById('mobileQuestionTitle'),
            questionText: document.getElementById('mobileQuestionText'),
            pointsText: document.getElementById('mobilePointsText'),
            teamSelect: document.getElementById('mobileTeamSelect'),
            playerNameGroup: document.getElementById('mobilePlayerNameGroup'),
            playerName: document.getElementById('mobilePlayerName'),
            answer: document.getElementById('mobileAnswer'),
            submit: document.getElementById('mobileSubmit'),
            response: document.getElementById('mobileResponse')
        };

        const modalElements = {
            correctModal: document.getElementById('correctModal'),
            gameCompleteModal: document.getElementById('gameCompleteModal'),
            earnedPoints: document.getElementById('earnedPoints'),
            closeModal: document.querySelector('.close-modal'),
            restartGame: document.getElementById('restartGame')
        };

        const tabs = document.querySelectorAll('.tab');

        // Initialize the game
        function initGame() {
            // Load data from localStorage if available
            const savedGameState = localStorage.getItem('quizGameState');
            if (savedGameState) {
                const parsedState = JSON.parse(savedGameState);
                gameState.questions = parsedState.questions || [];
                gameState.teams = parsedState.teams || [];
                gameState.scores = parsedState.scores || {};
                gameState.individualScores = parsedState.individualScores || {};
                gameState.answeredQuestions = new Set(parsedState.answeredQuestions || []);
            }

            // Set up event listeners
            tabs.forEach(tab => {
                tab.addEventListener('click', () => switchTab(tab.dataset.tab));
            });

            adminElements.addQuestion.addEventListener('click', addQuestion);
            adminElements.addTeam.addEventListener('click', addTeam);
            playerElements.submitAnswer.addEventListener('click', checkAnswer);
            playerElements.nextQuestion.addEventListener('click', nextQuestion);
            playerElements.resetGame.addEventListener('click', resetGame);
            modalElements.closeModal.addEventListener('click', closeModal);
            modalElements.restartGame.addEventListener('click', restartGame);
            mobileElements.submit.addEventListener('click', checkMobileAnswer);

            // Update displays
            updateQuestionsDisplay();
            updateTeamsDisplay();
            updateTeamSelect();
            updateMobileTeamSelect();
            updateScoreboard();
            updateIndividualLeaderboard();

            // Start with a question if available
            if (gameState.questions.length > 0) {
                nextQuestion();
            }
        }

        // Switch between player and admin tabs
        function switchTab(tabName) {
            tabs.forEach(tab => {
                if (tab.dataset.tab === tabName) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });

            if (tabName === 'player') {
                playerElements.panel.classList.add('active');
                adminElements.panel.classList.remove('active');
                mobileElements.panel.classList.remove('active');
            } else if (tabName === 'admin') {
                playerElements.panel.classList.remove('active');
                adminElements.panel.classList.add('active');
                mobileElements.panel.classList.remove('active');
            } else if (tabName === 'mobile') {
                playerElements.panel.classList.remove('active');
                adminElements.panel.classList.remove('active');
                mobileElements.panel.classList.add('active');
            }
        }

        // Add a new question
        function addQuestion() {
            const questionText = adminElements.questionText.value.trim();
            const correctAnswer = adminElements.correctAnswer.value.trim();
            const points = parseInt(adminElements.pointsValue.value);
            const type = adminElements.questionType.value;

            if (!questionText || !correctAnswer || isNaN(points) || points <= 0) {
                alert('Please fill in all fields with valid values.');
                return;
            }

            const question = {
                id: Date.now(),
                text: questionText,
                answer: correctAnswer.toLowerCase(),
                points: points,
                type: type
            };

            gameState.questions.push(question);
            saveGameState();
            updateQuestionsDisplay();
            
            // Clear form
            adminElements.questionText.value = '';
            adminElements.correctAnswer.value = '';
            adminElements.pointsValue.value = '10';
            
            // If this is the first question, start the game
            if (gameState.currentQuestionIndex === -1) {
                nextQuestion();
            }
        }

        // Update the questions display in the admin panel
        function updateQuestionsDisplay() {
            adminElements.questionsContainer.innerHTML = '';
            
            if (gameState.questions.length === 0) {
                adminElements.questionsContainer.innerHTML = '<p>No questions added yet.</p>';
                adminElements.questionsStatus.textContent = '(0/0 answered)';
                return;
            }
            
            const answeredCount = gameState.answeredQuestions.size;
            adminElements.questionsStatus.textContent = `(${answeredCount}/${gameState.questions.length} answered)`;
            
            gameState.questions.forEach(question => {
                const isAnswered = gameState.answeredQuestions.has(question.id);
                const questionElement = document.createElement('div');
                questionElement.className = `question-item ${isAnswered ? 'answered' : ''}`;
                questionElement.innerHTML = `
                    <div>
                        <strong>${question.text}</strong><br>
                        <small>Points: ${question.points} | Type: ${question.type} ${isAnswered ? '| ANSWERED' : ''}</small>
                    </div>
                    <button class="delete-btn" data-id="${question.id}">Delete</button>
                `;
                adminElements.questionsContainer.appendChild(questionElement);
            });

            // Add event listeners to delete buttons
            document.querySelectorAll('.delete-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const questionId = parseInt(this.getAttribute('data-id'));
                    deleteQuestion(questionId);
                });
            });
        }

        // Delete a question
        function deleteQuestion(questionId) {
            gameState.questions = gameState.questions.filter(q => q.id !== questionId);
            gameState.answeredQuestions.delete(questionId);
            saveGameState();
            updateQuestionsDisplay();
            
            // If we deleted the current question, move to the next one
            if (gameState.currentQuestionIndex >= gameState.questions.length) {
                gameState.currentQuestionIndex = -1;
                nextQuestion();
            }
        }

        // Add a new team
        function addTeam() {
            const teamName = adminElements.teamName.value.trim();
            
            if (!teamName) {
                alert('Please enter a team name.');
                return;
            }
            
            if (gameState.teams.includes(teamName)) {
                alert('Team name already exists.');
                return;
            }
            
            gameState.teams.push(teamName);
            gameState.scores[teamName] = 0;
            saveGameState();
            updateTeamsDisplay();
            updateTeamSelect();
            updateMobileTeamSelect();
            updateScoreboard();
            
            // Clear form
            adminElements.teamName.value = '';
        }

        // Update the teams display in the admin panel
        function updateTeamsDisplay() {
            adminElements.teamsContainer.innerHTML = '';
            
            if (gameState.teams.length === 0) {
                adminElements.teamsContainer.innerHTML = '<p>No teams added yet.</p>';
                return;
            }
            
            gameState.teams.forEach(team => {
                const teamElement = document.createElement('div');
                teamElement.className = 'team-item';
                teamElement.innerHTML = `
                    <div>${team}</div>
                    <button class="delete-btn" data-team="${team}">Delete</button>
                `;
                adminElements.teamsContainer.appendChild(teamElement);
            });

            // Add event listeners to delete buttons
            document.querySelectorAll('.delete-btn[data-team]').forEach(button => {
                button.addEventListener('click', function() {
                    const teamName = this.getAttribute('data-team');
                    deleteTeam(teamName);
                });
            });
        }

        // Delete a team
        function deleteTeam(teamName) {
            gameState.teams = gameState.teams.filter(t => t !== teamName);
            delete gameState.scores[teamName];
            saveGameState();
            updateTeamsDisplay();
            updateTeamSelect();
            updateMobileTeamSelect();
            updateScoreboard();
        }

        // Update the team select dropdown
        function updateTeamSelect() {
            playerElements.teamSelect.innerHTML = '<option value="">-- Select Team --</option>';
            
            gameState.teams.forEach(team => {
                const option = document.createElement('option');
                option.value = team;
                option.textContent = team;
                playerElements.teamSelect.appendChild(option);
            });
        }

        // Update the mobile team select dropdown
        function updateMobileTeamSelect() {
            mobileElements.teamSelect.innerHTML = '<option value="">-- Select Team --</option>';
            
            gameState.teams.forEach(team => {
                const option = document.createElement('option');
                option.value = team;
                option.textContent = team;
                mobileElements.teamSelect.appendChild(option);
            });
        }

        // Update the scoreboard
        function updateScoreboard() {
            playerElements.scoreboard.innerHTML = '';
            
            Object.keys(gameState.scores).forEach(team => {
                const scoreElement = document.createElement('div');
                scoreElement.className = 'team-score';
                scoreElement.innerHTML = `
                    <h3>${team}</h3>
                    <p>${gameState.scores[team]}</p>
                `;
                playerElements.scoreboard.appendChild(scoreElement);
            });
        }

        // Update the individual leaderboard
        function updateIndividualLeaderboard() {
            playerElements.individualLeaderboard.innerHTML = '';
            
            if (Object.keys(gameState.individualScores).length === 0) {
                playerElements.individualLeaderboard.innerHTML = '<p>No individual scores yet.</p>';
                return;
            }
            
            // Sort players by score (descending)
            const sortedPlayers = Object.entries(gameState.individualScores)
                .sort((a, b) => b[1] - a[1]);
            
            sortedPlayers.forEach(([playerName, score]) => {
                const playerElement = document.createElement('div');
                playerElement.className = 'leaderboard-item';
                playerElement.innerHTML = `
                    <span>${playerName}</span>
                    <span>${score} points</span>
                `;
                playerElements.individualLeaderboard.appendChild(playerElement);
            });
        }

        // Get a random unanswered question
        function getRandomUnansweredQuestion() {
            const unansweredQuestions = gameState.questions.filter(
                q => !gameState.answeredQuestions.has(q.id)
            );
            
            if (unansweredQuestions.length === 0) {
                return null; // All questions have been answered
            }
            
            const randomIndex = Math.floor(Math.random() * unansweredQuestions.length);
            const question = unansweredQuestions[randomIndex];
            
            // Find the index of this question in the main questions array
            gameState.currentQuestionIndex = gameState.questions.findIndex(q => q.id === question.id);
            gameState.currentQuestionId = question.id;
            
            return question;
        }

        // Move to the next question
        function nextQuestion() {
            if (gameState.questions.length === 0) {
                playerElements.questionDisplay.textContent = 'No questions available. Please add questions in the admin panel.';
                playerElements.pointsDisplay.textContent = 'Points: 0';
                playerElements.playerNameInput.style.display = 'none';
                playerElements.submitAnswer.disabled = true;
                return;
            }
            
            const question = getRandomUnansweredQuestion();
            
            if (!question) {
                // All questions have been answered
                playerElements.questionDisplay.textContent = 'All questions have been answered correctly!';
                playerElements.pointsDisplay.textContent = 'Game Complete!';
                playerElements.playerNameInput.style.display = 'none';
                playerElements.answerInput.style.display = 'none';
                playerElements.submitAnswer.style.display = 'none';
                playerElements.nextQuestion.disabled = true;
                
                // Show game completion modal
                setTimeout(() => {
                    modalElements.gameCompleteModal.style.display = 'flex';
                }, 500);
                return;
            }
            
            playerElements.questionDisplay.textContent = question.text;
            playerElements.pointsDisplay.textContent = `Points: ${question.points} (${question.type === 'team' ? 'Team' : 'Individual'})`;
            playerElements.answerInput.value = '';
            playerElements.playerNameInput.value = '';
            playerElements.answerInput.style.display = 'block';
            playerElements.submitAnswer.style.display = 'block';
            playerElements.submitAnswer.disabled = false;
            playerElements.nextQuestion.disabled = false;
            
            // Update mobile view
            mobileElements.questionText.textContent = question.text;
            mobileElements.pointsText.textContent = `Points: ${question.points} (${question.type === 'team' ? 'Team' : 'Individual'})`;
            mobileElements.answer.value = '';
            mobileElements.playerName.value = '';
            mobileElements.response.textContent = '';
            mobileElements.response.className = 'mobile-response';
            
            // Show/hide player name input based on question type
            if (question.type === 'individual') {
                playerElements.playerNameInput.style.display = 'block';
                mobileElements.playerNameGroup.style.display = 'block';
            } else {
                playerElements.playerNameInput.style.display = 'none';
                mobileElements.playerNameGroup.style.display = 'none';
            }
        }

        // Check the submitted answer (desktop)
        function checkAnswer() {
            const selectedTeam = playerElements.teamSelect.value;
            if (!selectedTeam) {
                alert('Please select a team first.');
                return;
            }
            
            if (gameState.currentQuestionIndex === -1) {
                alert('No question is currently active.');
                return;
            }
            
            const userAnswer = playerElements.answerInput.value.trim().toLowerCase();
            if (!userAnswer) {
                alert('Please enter an answer.');
                return;
            }
            
            const currentQuestion = gameState.questions[gameState.currentQuestionIndex];
            
            // For individual questions, check if player name is provided
            if (currentQuestion.type === 'individual') {
                const playerName = playerElements.playerNameInput.value.trim();
                if (!playerName) {
                    alert('Please enter your name for individual questions.');
                    return;
                }
            }
            
            processAnswer(selectedTeam, userAnswer, currentQuestion);
        }

        // Check the submitted answer (mobile)
        function checkMobileAnswer() {
            const selectedTeam = mobileElements.teamSelect.value;
            if (!selectedTeam) {
                mobileElements.response.textContent = 'Please select a team first.';
                mobileElements.response.className = 'mobile-response incorrect';
                return;
            }
            
            if (gameState.currentQuestionIndex === -1) {
                mobileElements.response.textContent = 'No question is currently active.';
                mobileElements.response.className = 'mobile-response incorrect';
                return;
            }
            
            const userAnswer = mobileElements.answer.value.trim().toLowerCase();
            if (!userAnswer) {
                mobileElements.response.textContent = 'Please enter an answer.';
                mobileElements.response.className = 'mobile-response incorrect';
                return;
            }
            
            const currentQuestion = gameState.questions[gameState.currentQuestionIndex];
            
            // For individual questions, check if player name is provided
            if (currentQuestion.type === 'individual') {
                const playerName = mobileElements.playerName.value.trim();
                if (!playerName) {
                    mobileElements.response.textContent = 'Please enter your name for individual questions.';
                    mobileElements.response.className = 'mobile-response incorrect';
                    return;
                }
                processAnswer(selectedTeam, userAnswer, currentQuestion, playerName);
            } else {
                processAnswer(selectedTeam, userAnswer, currentQuestion);
            }
        }

        // Process the answer (common function for both desktop and mobile)
        function processAnswer(selectedTeam, userAnswer, currentQuestion, playerName = null) {
            if (userAnswer === currentQuestion.answer) {
                // Correct answer
                const points = currentQuestion.points;
                
                // Mark question as answered
                gameState.answeredQuestions.add(currentQuestion.id);
                
                // Add points based on question type
                if (currentQuestion.type === 'team') {
                    // Add points to the team
                    gameState.scores[selectedTeam] += points;
                    mobileElements.response.textContent = `Correct! ${selectedTeam} earned ${points} points!`;
                } else {
                    // Add points to the individual player
                    if (!playerName) {
                        playerName = playerElements.playerNameInput.value.trim();
                    }
                    if (!gameState.individualScores[playerName]) {
                        gameState.individualScores[playerName] = 0;
                    }
                    gameState.individualScores[playerName] += points;
                    mobileElements.response.textContent = `Correct! ${playerName} earned ${points} points!`;
                }
                
                mobileElements.response.className = 'mobile-response correct';
                
                // Show modal with points earned (desktop)
                modalElements.earnedPoints.textContent = points;
                modalElements.correctModal.style.display = 'flex';
                
                // Add animation to question display
                playerElements.questionDisplay.classList.add('correct');
                setTimeout(() => {
                    playerElements.questionDisplay.classList.remove('correct');
                }, 1000);
                
                saveGameState();
                updateQuestionsDisplay();
                updateScoreboard();
                updateIndividualLeaderboard();
            } else {
                // Wrong answer
                mobileElements.response.textContent = 'Incorrect answer. Try again!';
                mobileElements.response.className = 'mobile-response incorrect';
                
                // Shake the screen (desktop)
                document.body.classList.add('shake');
                setTimeout(() => {
                    document.body.classList.remove('shake');
                }, 500);
                
                // Clear the input and focus for next attempt
                playerElements.answerInput.value = '';
                mobileElements.answer.value = '';
                if (currentQuestion.type === 'individual') {
                    playerElements.playerNameInput.focus();
                    mobileElements.playerName.focus();
                } else {
                    playerElements.answerInput.focus();
                    mobileElements.answer.focus();
                }
            }
        }

        // Close the modal and move to next question
        function closeModal() {
            modalElements.correctModal.style.display = 'none';
            modalElements.gameCompleteModal.style.display = 'none';
            nextQuestion();
        }

        // Restart the game (reset answered questions)
        function restartGame() {
            gameState.answeredQuestions.clear();
            saveGameState();
            updateQuestionsDisplay();
            nextQuestion();
            
            // Reset UI elements
            playerElements.answerInput.style.display = 'block';
            playerElements.submitAnswer.style.display = 'block';
            playerElements.submitAnswer.disabled = false;
            playerElements.nextQuestion.disabled = false;
        }

        // Reset the game
        function resetGame() {
            if (confirm('Are you sure you want to reset the game? This will clear all scores and answered questions.')) {
                // Reset scores and answered questions but keep teams and questions
                Object.keys(gameState.scores).forEach(team => {
                    gameState.scores[team] = 0;
                });
                gameState.individualScores = {};
                gameState.answeredQuestions.clear();
                
                saveGameState();
                updateScoreboard();
                updateIndividualLeaderboard();
                updateQuestionsDisplay();
                nextQuestion();
                
                // Reset UI elements
                playerElements.answerInput.style.display = 'block';
                playerElements.submitAnswer.style.display = 'block';
                playerElements.submitAnswer.disabled = false;
                playerElements.nextQuestion.disabled = false;
            }
        }

        // Save game state to localStorage
        function saveGameState() {
            const stateToSave = {
                ...gameState,
                answeredQuestions: Array.from(gameState.answeredQuestions)
            };
            localStorage.setItem('quizGameState', JSON.stringify(stateToSave));
        }

        // Check for URL parameters on page load
        function checkUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const questionId = urlParams.get('question');
            
            if (questionId) {
                // Switch to mobile view if question parameter is present
                switchTab('mobile');
                
                // Find the question by ID
                const questionIndex = gameState.questions.findIndex(q => q.id === parseInt(questionId));
                if (questionIndex !== -1) {
                    gameState.currentQuestionIndex = questionIndex;
                    const question = gameState.questions[questionIndex];
                    
                    // Update mobile view with the question
                    mobileElements.questionText.textContent = question.text;
                    mobileElements.pointsText.textContent = `Points: ${question.points} (${question.type === 'team' ? 'Team' : 'Individual'})`;
                    
                    // Show/hide player name input based on question type
                    if (question.type === 'individual') {
                        mobileElements.playerNameGroup.style.display = 'block';
                    } else {
                        mobileElements.playerNameGroup.style.display = 'none';
                    }
                }
            }
        }

        // Initialize the game when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            initGame();
            checkUrlParams();
        });
    </script>
</body>
</html>